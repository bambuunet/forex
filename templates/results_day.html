{% extends "base.html" %}

{% block body %}
<h1>Result {{ res['monthStr'] }}/{{ res['dayStr'] }} ({{ res['weekday'] }})</h1>

<ul>
  <li><a href="{{ res['backLink'] }}">Back to other results</a></li>
  <li><a href="{{ res['yearLink'] }}">Back to the whole year</a></li>
</ul>

<h2 class="color-success">Chart</h2>
<p>Accumulative pips include spread</p>
<div id="chart"></div>
<p class="text-center">
{% if res['month'] == 1 and res['day'] <= 2 %}
Yesterday
{% else %}
<a href="{{ res['yesterdayLink'] }}">Yesterday</a>
{% endif %}
  |  
{% if res['month'] == 12 and res['day'] >= 30 %}
Tomorrow
{% else %}
<a href="{{ res['tomorrowLink'] }}">Tomorrow</a>
{% endif %}
</p>
<script>
  var x = ['x'];
  var price = ['price'];

  var label = ['x'].concat({{ res['label'] }});
  var high = ['high'].concat({{ res['high'] }});
  var low = ['low'].concat({{ res['low'] }});
  var volume = ['volume'].concat({{ res['volume'] }});

  var region = [];
  {% for r in res['region'] %}
    region.push({
      axix: 'x', 
      start: {{r['start']}}, 
      end: {{r['end']}},
      class: "{{ r['class'] }}"
    });
  {% endfor %}

  var chart = c3.generate({
    data: {
      x: 'x',
      columns: [
        label,
        high,
        low,
        volume,
      ],
      axes: {
        high: 'y',
        low: 'y',
        volume: 'y2'
      },
      type: 'line',
      types: {
        volume: 'bar'
      },
      colors: {
        volume: '#f2d882'
      },
    },
    regions: region,
    axis: {
      x: {
        tick: {
          multiline: false,
        },
      },
      y2: {
        show: true
      }
    },
    grid: {
      y:{
        show : true,
        //lines : [{value:0}]
      }
    },
    point: {
      show: false // ポイントの表示
    },
    subchart: {
      show: true
    },
    zoom: {
      enabled: true
    },
    size: {
      height: 500
    },
  });
</script>


<table class="table table-bordered" >
  <tr class="bg-light">
    <th>Buy at</th>
    <th>Buy price</th>
    <th>Sell at</th>
    <th>Sell price</th>
    <th>Dir</th>
    <th>Gain</th>
    <th>Delta</th>
  </tr>
{% for i in res['result'].T %}
  {% if res['result']['gain'][i] > 0 %}
    <tr>
      <td>{{ res['result']['buy_at'][i] }}</td>
      <td>{{ res['result']['buy_price'][i] }}</td>
      <td>{{ res['result']['sell_at'][i] }}</td>
      <td>{{ res['result']['sell_price'][i] }}</td>
      <td>{{ res['result']['dir'][i] }}</td>
      <td>{{ '%0.1f'| format(res['result']['gain'][i]) }}</td>
      <td>{{ res['result']['delta'][i] }}</td>
    </tr>
  {% else %}
    <tr class="color-error">
      <td>{{ res['result']['buy_at'][i] }}</td>
      <td>{{ res['result']['buy_price'][i] }}</td>
      <td>{{ res['result']['sell_at'][i] }}</td>
      <td>{{ res['result']['sell_price'][i] }}</td>
      <td>{{ res['result']['dir'][i] }}</td>
      <td>{{ '%0.1f'| format(res['result']['gain'][i]) }}</td>
      <td>{{ res['result']['delta'][i] }}</td>
    </tr>
  {% endif %}
{% endfor %}
</table>

{% endblock %}
